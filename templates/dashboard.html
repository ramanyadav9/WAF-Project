<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>CyberSentinel – Security Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      background: #f4f8fb;
      color: #213251;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Arial, sans-serif;
    }
    .logo-block {
      background: linear-gradient(130deg, #e8f1fc 60%, #f4f8fb 100%);
      border-bottom: 2px solid #385984;
      text-align: center;
      padding: 6vh 0 22px 0;
    }
    .logo-block img {
      height: 68px;
      margin-bottom: 8px;
      border-radius: 13px;
      background: #fff;
      padding: 4px 10px;
      box-shadow: 0 3px 22px 0 rgba(52,85,140,0.13);
    }
    .logo-block h1 {
      font-size: 2.15rem;
      font-weight: 800;
      color: #213251;
      margin: 7px 0 2px 0;
      letter-spacing: 2px;
    }
    .logo-block p {
      color: #385984;
      font-size: 1.04rem;
      margin-top: 6px;
      margin-bottom: 9px;
      font-weight: 450;
    }
    .container {
      max-width: 1020px;
      margin: 35px auto 0;
      background: #fff;
      padding: 30px 18px;
      border-radius: 16px;
      box-shadow: 0 6px 26px rgba(40,60,130,0.10);
    }
    h2 {
      color: #253f73;
      font-size: 1.5em;
      margin-top: 20px;
      margin-bottom: 7px;
    }
    .stat-row {
      margin-bottom: 20px;
    }
    .stat-row strong {
      color: #2240b6;
      font-size: 1.13em;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
      background: #fafcff;
      border-radius: 14px;
      overflow: hidden;
      box-shadow: 0 2px 16px 0 rgba(25,75,160,0.07);
    }
    th, td {
      padding: 13px 10px 11px 10px;
      text-align: left;
      border-bottom: 1px solid #e3eaf7;
      font-size: 1em;
    }
    th {
      background: #e8f1fc;
      color: #213251;
      font-weight: 700;
      font-size: 1.01em;
    }
    td {
      background: transparent;
      color: #253f73;
      font-weight: 430;
    }
    tr:last-child td {
      border-bottom: none;
    }
    .status-badge {
      background: linear-gradient(90deg,#41a9e4 30%, #2240b6 100%);
      color: #fff;
      padding: 4px 12px;
      border-radius: 6px;
      font-size: 0.88em;
      font-weight: 600;
      box-shadow: 0 2px 7px 0 rgba(65,169,228,0.07);
      letter-spacing: 1px;
      display: inline-block;
    }
    p {
      line-height: 1.7;
      color: #395b88;
      margin-top: 8px;
    }
    .disrupted { background-color: #ffdddd; }  /* Red for blocked */
    .allowed { background-color: #ddffdd; }    /* Green for allowed */
    @media (max-width:600px) {
      .container { padding: 13px 3vw; }
      .logo-block img { height: 48px; }
      th, td { padding: 9px 6px; font-size: 0.97em; }
    }
  </style>
</head>
<body>
  <div class="logo-block">
    <img src="{{ url_for('static', filename='company_logo.png') }}" alt="CyberSentinel Logo">
    <h1>CyberSentinel</h1>
    <p>Welcome to our Security Gateway – your connection is protected.</p>
  </div>
  <div class="container">
    <h2>CyberSentinel WAF Logs</h2>
    <div class="stat-row"><strong>Total Logs:</strong> {{ (attempts | length) + (modsec_logs | length) }}</div>
    {% if attempts or modsec_logs %}
      <table>
        <thead>
          <tr>
            <th>#</th>
            <th>Type</th>
            <th>IP</th>
            <th>Details</th>
            <th>Timestamp</th>
            <th>Country</th>
            <th>ISP</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody id="log-list">
          {% set all_logs = attempts + modsec_logs %}
          {% for log in all_logs %}
            {% if log in attempts %}
              <tr>
                <td>{{ loop.index }}</td>
                <td>SQL Injection</td>
                <td>{{ log[0] }}</td>
                <td>{{ log[1] }}</td>
                <td>{{ log[2] }}</td>
                <td>{{ log[3] }}</td>
                <td>{{ log[4] }}</td>
                <td><span class="status-badge">Blocked</span></td>
              </tr>
            {% else %}
              <tr class="{% if log[5] %}disrupted{% else %}allowed{% endif %}">
                <td>{{ loop.index }}</td>
                <td>CyberSentinel WAF</td>
                <td>{{ log[1] }}</td>
                <td>URI: {{ log[2] }} | Method: {{ log[3] }} | Rules: {{ log[6] }}</td>
                <td>{{ log[0] }}</td>
                <td>N/A</td>  <!-- Placeholder; can add geolocation if needed -->
                <td>N/A</td>  <!-- Placeholder -->
                <td>{{ 'Blocked' if log[5] else 'Allowed' }}</td>
              </tr>
            {% endif %}
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p>No logs yet.</p>
    {% endif %}
  </div>
  <script>
    async function fetchAttempts() {
      const response = await fetch('/api/attempts');
      const attempts = await response.json();
      const tbody = document.getElementById('log-list');
      tbody.innerHTML = '';
      attempts.forEach((attempt, index) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td>${index + 1}</td>
            <td>SQL Injection</td>
            <td>${attempt.ip}</td>
            <td>${attempt.attempted}</td>
            <td>${attempt.timestamp}</td>
            <td>${attempt.country}</td>
            <td>${attempt.isp}</td>
            <td><span class="status-badge">Blocked</span></td>
        `;
        tbody.appendChild(tr);
      });
      // Note: ModSecurity logs would need a separate API endpoint for live refresh if desired
    }
    setInterval(fetchAttempts, 5000);
    fetchAttempts();
  </script>
</body>
</html>
